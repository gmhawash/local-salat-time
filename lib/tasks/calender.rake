namespace :calendar do
  desc "import month" 
  task :import => [:setup_locations] do 

    header = [
     :fajr_athan, :fajr_iqama, 
     :sunrise,
     :dhuhr_athan, :dhuhr_iqama, 
     :asr_athan, :asr_iqama, 
     :maghrib_athan, :maghrib_iqama, 
     :isha_athan, :isha_iqama
    ]

    
    %w(furqan assaber).each do |name| 
      location = Location.find_or_create_by :nickname => name

      month.split("\n").each do |day|
        times = day.split(" ").map(&:strip)
        date = Date.strptime(times.shift, '%m/%d/%Y')
        hijri = times.shift.to_i
        times = Hash[header.zip(times)]
        
        day = Day.find_or_create_by_date_and_location_id date, location.id

        day.update_attributes :hijri => hijri, :times => times
      end
    end
  end

  task :setup_locations => :environment do
    location = Location.find_or_create_by :nickname => 'furqan', :name => 'Masjid Al-Furqan', :city => 'Portland'
    location = Location.find_or_create_by :nickname => 'assaber', :name => 'Masjid As-Saber', :city => 'Portland'
  end

  def month
     <<-MONTH
    11/1/2013	27	6:27	6:30	7:51	12:54	1:30	3:32	4:00	5:57	6:07	7:20	8:00
    11/2/2013 28  6:28  6:50  7:52  12:54 1:30  3:30  3:45  5:55  6:05  7:19  8:00
    11/3/2013 29  5:30  5:50  6:53  11:54 12:30 2:29  2:45  4:54  5:04  6:18  7:30
    11/4/2013 30  5:31  5:50  6:55  11:54 12:30 2:28  2:45  4:53  5:03  6:16  7:30
    11/5/2013 31  5:32  5:50  6:56  11:54 12:30 2:27  2:45  4:51  5:01  6:15  7:30
    11/6/2013 32  5:33  5:50  6:58  11:54 12:30 2:26  2:45  4:50  5:00  6:14  7:30
    11/7/2013 33  5:35  5:50  6:59  11:54 12:30 2:25  2:45  4:49  4:59  6:13  7:30
    11/8/2013 34  5:36  5:50  7:00  11:54 12:30 2:24  2:45  4:47  4:57  6:12  7:30
    11/9/2013 35  5:37  6:00  7:02  11:54 12:30 2:23  2:45  4:46  4:56  6:11  7:30
    11/10/2013  36  5:38  6:00  7:03  11:54 12:30 2:22  2:45  4:45  4:55  6:10  7:30
    11/11/2013  37  5:40  6:00  7:05  11:54 12:30 2:21  2:45  4:44  4:54  6:09  7:30
    11/12/2013  38  5:41  6:00  7:06  11:55 12:30 2:20  2:45  4:43  4:53  6:08  7:30
    11/13/2013  39  5:42  6:00  7:07  11:55 12:30 2:20  2:45  4:42  4:57  6:07  7:30
    11/14/2013  40  5:43  6:00  7:09  11:55 12:30 2:19  2:45  4:40  4:55  6:06  7:30
    11/15/2013  41  5:44  6:00  7:10  11:55 12:30 2:18  2:45  4:39  4:54  6:05  7:30
    11/16/2013  42  5:46  6:10  7:12  11:55 12:30 2:17  2:30  4:38  4:48  6:04  7:30
    11/17/2013  43  5:47  6:10  7:13  11:55 12:30 2:16  2:30  4:37  4:47  6:04  7:30
    11/18/2013  44  5:48  6:10  7:14  11:56 12:30 2:16  2:30  4:37  4:47  6:03  7:30
    11/19/2013  45  5:49  6:10  7:16  11:56 12:30 2:15  2:30  4:36  4:46  6:02  7:30
    11/20/2013  46  5:50  6:10  7:17  11:56 12:30 2:14  2:30  4:35  4:45  6:02  7:30
    11/21/2013  47  5:51  6:10  7:18  11:56 12:30 2:14  2:30  4:34  4:44  6:01  7:30
    11/22/2013  48  5:52  6:10  7:20  11:57 12:30 2:13  2:30  4:33  4:43  6:00  7:30
    11/23/2013  49  5:54  6:15  7:21  11:57 12:30 2:13  2:30  4:33  4:43  6:00  7:30
    11/24/2013  50  5:55  6:15  7:22  11:57 12:30 2:12  2:30  4:32  4:42  5:59  7:30
    11/25/2013  51  5:56  6:15  7:23  11:58 12:30 2:12  2:30  4:31  4:41  5:59  7:30
    11/26/2013  52  5:57  6:15  7:25  11:58 12:30 2:11  2:30  4:31  4:41  5:58  7:30
    11/27/2013  53  5:58  6:15  7:26  11:58 12:30 2:11  2:30  4:30  4:40  5:58  7:30
    11/28/2013  54  5:59  6:15  7:27  11:58 12:30 2:10  2:30  4:29  4:39  5:58  7:30
    11/29/2013  55  6:00  6:15  7:28  11:59 12:30 2:10  2:30  4:29  4:39  5:57  7:30
    11/30/2013  56  6:01  6:20  7:30  11:59 12:30 2:10  2:30  4:29  4:39  5:57  7:30
    MONTH
  end
end





























































